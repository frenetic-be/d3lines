var d3lines=function(){function Ca(a){return void 0!==a&&null!==a}function Da(a){return!isNaN(parseFloat(a))&&isFinite(a)}function Ea(a){var b={};return a&&"[object Function]"===b.toString.call(a)}function Fa(a){return"string"==typeof a||a instanceof String}function Ga(a){try{var b=new Date(a);if(isNaN(b.getTime()))return;return b}catch(a){return}}function Ha(a){return"[object Array]"==Object.prototype.toString.call(a)}function Ia(a,b,c,d){if(arguments.length<4&&(d=!0),!Ca(a))return c;if(!a.hasOwnProperty(b))return c;var e=a[b];return d&&delete a[b],e}function Ja(a){return Da(a)?"float":Ha(a)?"array":typeof a}function Ka(a){var b={};if(!Ca(a))return a;var c=Object.keys(a);return 0===c.length||Fa(a)||a instanceof La?a:Ha(a)?(b=[],a.forEach(function(a,c){b.push(Ka(a))}),b):(c.forEach(function(c){b[c]=Ka(a[c])}),b)}function La(a){if(!Ca(a))return void(this.data=a);if(!(this instanceof La))return new La(a);var b=Ja(a);if("array"===b){if(0!=a.length){var c=Ja(a[0]),d=a.reduce(function(a,b){return a&&Ja(b)===c});if(!d)throw TypeError("Data has mixed types");if("object"===c)this.data=a;else if("array"===c){var e=[];a.forEach(function(a,b){e.push({}),a.forEach(function(a,c){e[b]["y"+(c+1)]=a})}),this.data=e}else{if("float"!==c)throw TypeError("Data type is not supported");var e=[];a.forEach(function(a){e.push({y:a})}),this.data=e}}}else{if("object"!==b)throw TypeError("Data type is not supported");var g,e=[],f=Object.keys(a);f.forEach(function(b,c){if(!Ha(a[b]))throw TypeError("Data type is not supported");if(0===c)g=a[b].length;else if(a[b].length!==g)throw TypeError("Inconsistent number of elements for different keys");a[b].forEach(function(a,d){0===c&&e.push({}),e[d][b]=a})}),this.data=e}}function Ma(a){this.group=a}function Na(a,b,c,d){if(!(this instanceof Na))return new Na(a,b,c,d);Ma.call(this,a),this.lines=b,this.areas=c,this.markers=d}function Oa(a,b,c,d){if(!(this instanceof Oa))return new Oa(a,b,c,d);Ma.call(this,a),this.x=b,this.y=c,this.y2=d}function Pa(a,b,c,d,e){if(!(this instanceof Pa))return new Pa(a,b,c,d,e);Ma.call(this,a),this.x=b,this.y=c,this.y2=d,this.labels=void 0===e?new Oa:e}function Qa(a){if(!(this instanceof Qa))return new Qa(a);Ma.call(this,a)}function Ra(a,b){if(!(this instanceof Ra))return new Ra(a,b);Ma.call(this,a),this.rect=b}function Sa(a,b,c,d,e,f){if(!(this instanceof Sa))return new Sa(a,b,c,d,e,f);Ma.call(this,a),this.hline=b,this.vline=c,this.dots=d,this.box=e,this.text=f}function Ta(a){if(!(this instanceof Ta))return new Ta(a);this.main=a,this.axes=new Pa,this.box=new Ra,this.lines=new Na,this.legend=new Qa,this.interactive=new Sa}function Ua(a){if(arguments.length<1)throw TypeError("d3lines.Chart takes 1 argument: a d3.Selection of an svg tag.");if(!(this instanceof Ua))return new Ua(a);this.options={},this.width=void 0,this.height=void 0,this.margins={},this.xaxis=void 0,this.yaxis=void 0,this.y2axis=void 0,this.line_options=[],this.scale={},this.svg=new Ta(a)}function Va(a,b,c,d){return d3.svg.line().x(function(b,c){return a(d.hasOwnProperty("x")?d.x[c]:c)}).y(function(a,e){return d.hasOwnProperty("y")?b(d.offset_y[e]):d.hasOwnProperty("y2")?c(d.offset_y2[e]):b(e)}).interpolate(d.interpolation)}function Wa(a,b,c,d,e){return Ca(c)||(paddingLeft=parseFloat(window.getComputedStyle(a.node()).paddingLeft),paddingRight=parseFloat(window.getComputedStyle(a.node()).paddingRight),c=d3.scale.linear().range([-paddingLeft,a.node().clientWidth-paddingRight]).domain([0,1])),Ca(d)||(paddingTop=parseFloat(window.getComputedStyle(a.node()).paddingTop),paddingBottom=parseFloat(window.getComputedStyle(a.node()).paddingBottom),d=d3.scale.linear().range([a.node().clientHeight-paddingBottom,-paddingTop]).domain([0,1])),pa=Ia(e,"line_color","#777",!1),qa=Ia(e,"line_width",1,!1),ra=Ia(e,"line_style","-",!1),a.append("line").attr("x1",c(b)).attr("y1",d.range()[0]).attr("x2",c(b)).attr("y2",d.range()[1]).style("stroke",pa).style("stroke-width",qa).style("stroke-dasharray",$a(ra))}function Xa(a,b,c,d,e){return Ca(c)||(paddingLeft=parseFloat(window.getComputedStyle(a.node()).paddingLeft),paddingRight=parseFloat(window.getComputedStyle(a.node()).paddingRight),c=d3.scale.linear().range([-paddingLeft,a.node().clientWidth-paddingRight]).domain([0,1])),Ca(d)||(paddingTop=parseFloat(window.getComputedStyle(a.node()).paddingTop),paddingBottom=parseFloat(window.getComputedStyle(a.node()).paddingBottom),d=d3.scale.linear().range([a.node().clientHeight-paddingBottom,-paddingTop]).domain([0,1])),pa=Ia(e,"line_color","#777",!1),qa=Ia(e,"line_width",1,!1),ra=Ia(e,"line_style","-",!1),a.append("line").attr("x1",c.range()[0]).attr("y1",d(b)).attr("x2",c.range()[1]).attr("y2",d(b)).style("stroke",pa).style("stroke-width",qa).style("stroke-dasharray",$a(ra))}function Ya(a){return a.each(function(){var a=d3.select(this),b={},c=d3.select(a.property("nearestViewportElement")),d=parseFloat(a.attr("data-style-padding")||5);lb=a.selectAll(".legend-box").data([!0]),lb.enter().append("rect").classed("legend-box",!0),c.selectAll("[data-legend]").each(function(){for(var a=d3.select(this),c=a.attr("data-legend");b.hasOwnProperty(c);){var d=c.split("-"),e=c,f=2;d.length>1&&Da(d[d.length-1])&&(f=parseFloat(d[d.length-1])+1,e=d.slice(0,d.length-1).join("-")),c=e+"-"+f}b[c]={pos:a.attr("data-legend-pos")||this.getBBox().y,line_color:"none"!==a.attr("data-line-color")?a.attr("data-line-color"):a.attr("data-line-fill"),line_width:a.attr("data-line-width"),line_style:a.attr("data-line-style"),marker:a.attr("data-marker"),marker_fill:a.attr("data-marker-fill"),marker_fill_opacity:a.attr("data-marker-fill-opacity"),marker_size:a.attr("data-marker-size"),marker_stroke_width:a.attr("data-marker-stroke-width"),symbol:""!==_a(a.attr("data-marker"),6)?_a(a.attr("data-marker"),6)():null}}),b=d3.entries(b).sort(function(a,b){return a.value.pos-b.value.pos});var e=a.append("g").attr("class","legend-items"),f=parseFloat(window.getComputedStyle(e[0][0]).getPropertyValue("font-size")),g=e.selectAll("g").data(b),h=g.enter().append("g").attr("transform",function(a,b){return"translate(0, "+1.2*b*f+")"});h.append("line").attr("x2","1.5em").attr("y1","-0.38em").attr("y2","-0.38em").style("fill","none").style("stroke",function(a){return a.value.line_color}).style("stroke-width",function(a){return a.value.line_width}).style("stroke-dasharray",function(a){return $a(a.value.line_style)}),h.append("path").attr("d",function(a){return a.value.symbol}).attr("transform",function(a,b){return"translate("+.75*f+", "+-.38*f+")"}).style("stroke",function(a){return a.value.line_color}).style("fill",function(a){return"color"===a.value.marker_fill?a.value.line_color:a.value.marker_fill}).style("fill-opacity",function(a){return a.value.marker_fill_opacity}).style("stroke-width",function(a){return a.value.marker_stroke_width}),h.append("text").attr("x","2em").text(function(a){return a.key});var i=e[0][0].getBBox();e.attr("transform","translate("+(-i.x+d)+","+(-i.y+d)+")"),lb.attr("x",0).attr("y",0).attr("height",i.height+2*d).attr("width",i.width+2*d)}),a}function Za(b,c,d,e,f,g){if(Da(e)){if(e<=0)throw"ValueError: `layoutType` should be a strictly positive number.";var h,i,j,k;if(Ca(b))switch(d){case"x":c.forEach(function(a){a.hasOwnProperty("x")?(h=d3.min([h,d3.min(a.x)]),i=d3.max([i,d3.max(a.x)])):(h=0,i=b.length)});break;case"y":c.forEach(function(a){a.hasOwnProperty("y")&&(h=d3.min([h,d3.min(a.offset_y)]),i=d3.max([i,d3.max(a.offset_y)]))});break;case"y2":c.forEach(function(a){a.hasOwnProperty("y2")&&(h=d3.min([h,d3.min(a.offset_y2)]),i=d3.max([i,d3.max(a.offset_y2)]))})}else h=0,i=1;if(Ca(h)||(h=0),Ca(i)||(i=1),g&&(h=d3.min([h,f.domain()[0]]),i=d3.max([i,f.domain()[1]])),f.type!==a.LOG||h instanceof Date||i instanceof Date)if(f.type===a.LOG&&h instanceof Date&&i instanceof Date){if(h<0||i<0)throw"ValueError: Cannot use a logarithmic scale with negative data";var l=Math.log10(i.getTime())-Math.log10(h.getTime()),m=Math.log10(h)+l/2,n=l*e;j=new Date(Math.pow(10,m-n/2)),k=new Date(Math.pow(10,m+n/2))}else if(h instanceof Date&&i instanceof Date){var l=i.getTime()-h.getTime(),m=h.getTime()+l/2,n=l*e;j=new Date(m-n/2),k=new Date(m+n/2)}else{var l=i-h,m=h+l/2,n=l*e;j=m-n/2,k=m+n/2}else{if(h<0||i<0)throw"ValueError: Cannot use a logarithmic scale with negative data";var l=Math.log10(i)-Math.log10(h),m=Math.log10(h)+l/2,n=l*e;j=Math.pow(10,m-n/2),k=Math.pow(10,m+n/2)}}else{if(!Ha(e)||2!=e.length)throw TypeError("`layoutType` should be a strictly-positive float or a two-element float array");if(j=e[0],k=e[1],!Da(j)||!Da(k))throw TypeError("`layoutType` should be a two-element float array")}f.domain([j,k])}function $a(a){switch(a){case":":case"dotted":return"1 1";case"-":case"solid":return"";case"--":case"dashed":return"3 3";case"-.":case"dash-dot":return"5 2 1 2";default:return a}}function _a(a,b){var c=v*v;switch(Da(b)?c=b*b:Ea(b)&&(c=function(a,c){return b(a,c)*b(a,c)}),a){case"o":case"circle":return d3.svg.symbol().type("circle").size(c);case"+":case"cross":return d3.svg.symbol().type("cross").size(c);case"d":case"diamond":return d3.svg.symbol().type("diamond").size(c);case"s":case"square":return d3.svg.symbol().type("square").size(c);case"^":case"triangle-up":return d3.svg.symbol().type("triangle-up").size(c);case"v":case"triangle-down":return d3.svg.symbol().type("triangle-down").size(c);default:return""}}function ab(a,b){return Ha(a)?a[b%a.length]:a}function bb(a,b){var c={};if(Ca(a)&&Object.keys(a).forEach(function(b,d){c[b]=a[b]}),c.hasOwnProperty("color")||(c.color=ab(pa,b)),c.hasOwnProperty("width")||(c.width=ab(qa,b)),c.hasOwnProperty("style")||(c.style=ab(ra,b)),c.hasOwnProperty("fill")||(c.fill=ab(sa,b)),c.hasOwnProperty("fill_opacity")||(c.fill_opacity=ab(ta,b)),c.hasOwnProperty("interpolation")||(c.interpolation=ab(ua,b)),c.hasOwnProperty("marker")||(c.marker=ab(va,b)),c.hasOwnProperty("marker_fill")||(c.marker_fill=ab(wa,b)),c.hasOwnProperty("marker_fill_opacity")||(c.marker_fill_opacity=ab(xa,b)),c.hasOwnProperty("marker_stroke_width")||(c.marker_stroke_width=ab(ya,b)),c.hasOwnProperty("marker_size")||(c.marker_size=ab(za,b)),!c.hasOwnProperty("ykey")&&!c.hasOwnProperty("y2key"))throw"Line does not have an `ykey` or `y2key` property. The `ykey` or `y2key` property should be the names of a field of all data element objects.";return c}function cb(a,b,c){var e=null,f=null,g=null,h=null;b.forEach(function(b,d){b.hasOwnProperty(c)&&b[c].forEach(function(b,c){Ca(b)&&!isNaN(b)&&(null===e||Math.abs(b-a)<f)&&(e=b,g=c,h=d,f=Math.abs(a-e))})});var i={};return b.forEach(function(a){a.hasOwnProperty(c)&&a[c].forEach(function(b,c){(b===e||b instanceof Date&&e instanceof Date&&b.getTime()===e.getTime())&&(a.hasOwnProperty("xkey")&&!isNaN(a.x[c])&&(i[a.xkey]=a.x[c]),a.hasOwnProperty("ykey")&&!isNaN(a.y[c])&&(i[a.ykey]=a.y[c]),a.hasOwnProperty("y2key")&&!isNaN(a.y2[c])&&(i[a.y2key]=a.y2[c]))})}),[i,h,g]}function db(a,b,c,d,e,f){function g(a,b,c,e,f){return Math.sqrt(Math.pow(a-d(c),2)+Math.pow(b-f(e),2))}var i,j,s,k="",l="",m=null,n=null,o=null,p=null,q=null,r=null,t="";c.forEach(function(c,d){c.x.forEach(function(h,u){c.hasOwnProperty("y")?(i=c.offset_y[u],j=c.y[u],s=e,t="y"):(i=c.offset_y2[u],j=c.y2[u],s=f,t="y2"),Ca(h)&&!isNaN(h)&&Ca(i)&&!isNaN(i)&&(null===m||g(a,b,h,i,s)<r)&&(m=h,n=j,p=u,q=d,k=c.xkey,l=c.hasOwnProperty("y")?c.ykey:c.y2key,r=g(a,b,h,i,s),o=t)})});var u={};return u[k]=m,u[l]=n,[u,q,p,o]}function eb(a,b){var c=Ia(b,"box",C,!1),d=Ia(b,"axes_font_size",ga,!1),e=Ia(b,"axes_font_color",ja,!1),f=Ia(b,"axes_font_family",ia,!1),g=Ia(b,"axes_color",ja,!1),h=Ia(b,"axes_width",ka,!1),i=Ia(b,"axes_linestyle",na,!1);c?a.selectAll(".d3lines-axis path").each(function(){d3.select(this).style("fill","none").style("stroke","none")}):a.selectAll(".d3lines-axis path").each(function(){d3.select(this).style("fill","none").style("stroke",g).style("stroke-width",h).style("stroke-dasharray",$a(i))}),a.selectAll(".d3lines-axis line").each(function(){var a=d3.select(this);a.classed("d3lines-grid")||a.style("stroke",g).style("stroke-width",h).style("stroke-dasharray",$a(i))}),a.selectAll(".d3lines-axis text").each(function(){var a=d3.select(this);a.style("font-size",d),void 0!==e&&a.style("fill",e),void 0!==f&&a.style("font-family",f)})}function fb(a,b,c){Ca(b)||(b={});var g=Ia(b,"width",d,!1),h=Ia(b,"height",e,!1),i=Ka(f);if(Ca(b.margins)&&Object.keys(b.margins).forEach(function(a){i[a]=b.margins[a]}),Ia(b,"xgrid",D,!1)){var k=Ia(b,"xgrid_color",E,!1),l=Ia(b,"xgrid_width",F,!1),m=Ia(b,"xgrid_linestyle",G,!1);a.selectAll(".d3lines-xaxis .tick").each(function(a,b){var c=d3.select(this);0===c.selectAll("line.d3lines-grid").size()&&c.append("line").attr("class","d3lines-grid d3lines-xgrid").attr("y2",-h+i.bottom+i.top).style("stroke",k).style("stroke-width",l).style("stroke-dasharray",$a(m))})}if(Ia(b,"ygrid",H,!1)){var o=Ia(b,"ygrid_color",I,!1),p=Ia(b,"ygrid_width",J,!1),q=Ia(b,"ygrid_linestyle",K,!1);a.selectAll(".d3lines-yaxis .tick").each(function(a,b){var c=d3.select(this);0===c.selectAll("line.d3lines-grid").size()&&c.append("line").attr("class","d3lines-grid d3lines-ygrid").attr("x2",g-i.left-i.right).style("stroke",o).style("stroke-width",p).style("stroke-dasharray",$a(q))})}var r=Ia(b,"y2grid",L,!1);if(c&&r){var s=Ia(b,"y2grid_color",M,!1),t=Ia(b,"y2grid_width",N,!1),u=Ia(b,"y2grid_linestyle",O,!1);a.selectAll(".d3lines-y2axis .tick").each(function(a,b){var c=d3.select(this);0===c.selectAll("line.d3lines-grid").size()&&c.append("line").attr("class","d3lines-grid d3lines-y2grid").attr("x2",-g+i.left+i.right).style("stroke",s).style("stroke-width",t).style("stroke-dasharray",$a(u))})}}var w,x,y,z,A,B,R,S,ia,a={LINEAR:"LINEAR",LOG:"LOG",TIME:"TIME"},b=!0,c="line",d=800,e=500,f={top:15,right:70,bottom:50,left:70},g="left",h=["blue","red","limegreen","magenta","cyan","black","orange"],i=1.5,j=0,k="-",l="none",m=1,n="linear",o="",p=["o","s","v","d","^","+"],q="white",r=["#ddf","#fdd","#ded","#fdf","#dff","#ddd","#fed"],s=1,t=1,u=1,v=8,C=!0,D=!1,E="#BBB",F=.5,G=":",H=!1,I="#BBB",J=.5,K=":",L=!1,M="#BBB",N=.5,O=":",P=!0,Q="0.875em",T="none",U=1,V="#777",W=1,X="-",Y="top left",Z=1,$=1.05,_=1.05,aa="",ba="",ca="",da=0,ea=0,fa=0,ga="1em",ja="#777",ka=1,la="none",ma=1,na="-",oa=!0;DEFAULT_INTERACTIVE_OPTIONS={snap_axis:"x",line:!0,line_style:"-",line_width:1,line_color:"#777",dots:!0,dot_radius:5,textbox:!0,box_fill:"#ffb4b4",box_padding:10,box_fill_opacity:.95,font_size:"1em",font_color:"black",font_family:"",output_string:function(a){var b=[];return Object.keys(a).forEach(function(c,d){b.push(c+": "+a[c])}),b.join("<br>")},zoom:!0};var pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba;return La.prototype.toString=function(){return"[object d3lines.Data]"},La.prototype.transpose=function(a,b){Ca(a)||(a=""),Ca(b)||(b=a),""===b&&(b="x");var c=this.data;if(Ca(c)){if(!Ha(c))throw TypeError("The data should be an array of dictionaries.");if(0!==c.length){var e,d=[];return c.forEach(function(f,g){e=f[a],Object.keys(c[0]).filter(function(b){return b.trim()!==a}).forEach(function(a,c){0===g&&(d.push({}),d[c][b]=a),d[c][e]=f[a]})}),new La(d)}}},La.prototype.sanitize=function(){var a=this.data;if(Ca(a)){if(!Ha(a))throw TypeError("The data should be an array of dictionaries.");if(a=a.filter(function(a){return Object.keys(a).length>0}),0!==a.length){var b=Object.keys(a[0]).filter(function(a){return""!==a.trim()}),c=[];b.forEach(function(b){"object"==typeof a[0][b]?c.push("object"):Da(a[0][b])||"string"==typeof a[0][b]&&""===a[0][b].trim()?c.push("float"):Ca(Ga(a[0][b]))?c.push("date"):c.push("string")});var e,f,d=[];return a.forEach(function(a){e={},f=!0,b.forEach(function(b,d){switch(c[d]){case"object":null==a[b]?e[b]=NaN:(e[b]=a[b],f=!1);break;case"string":case"float":Da(a[b])?"string"==typeof a[b]&&""===a[b].trim()?e[b]=NaN:(e[b]=parseFloat(a[b]),f=!1):e[b]=NaN;break;case"date":var h=Ga(a[b]);Ca(h)?(e[b]=h,f=!1):e[b]=NaN}}),f||d.push(e)}),new La(d)}}},La.prototype.removeNaNColumns=function(){var a=this.data;if(Ca(a)){if(!Ha(a))throw TypeError("The data should be an array of dictionaries.");if(0!==a.length){var b=Object.keys(a[0]);for(dataIndex in a)if(row=a[dataIndex],b.forEach(function(a,c){"number"==typeof row[a]&&isNaN(row[a])||delete b[b.indexOf(a)]}),b.every(function(a){return!Ca(a)}))break;if(b=b.filter(Ca),0===b.length)return new La(a);var c=[];for(dataIndex in a)row=a[dataIndex],b.forEach(function(a,b){delete row[a]}),c.push(row);return new La(c)}}},La.prototype.sample=function(a,b){var c=this.data;if(1==arguments.length?(b=a,a=0):0==arguments.length&&(a=0,b=5),Ca(c)){if(!Ha(c))throw TypeError("The data should be an array of dictionaries.");if(0!==c.length){var d=[],f=[];return c.forEach(function(e,g){0==g&&(f=Object.keys(c[0]).filter(function(a){return""!==a.trim()}));var h={};f.slice(a,b).forEach(function(a,b){h[a]=e[a]}),d.push(h)}),new La(d)}}},La.prototype.selectColumns=function(a){var b=this.data;if(Ca(b)){if(!Ha(b))throw TypeError("The data should be an array of dictionaries.");if(0!==b.length&&Ca(a)&&Ha(a)){var c=[],e=[];return b.forEach(function(d,f){0==f&&(e=Object.keys(b[0]).filter(function(b){return-1!=a.indexOf(b)}));var g={};e.forEach(function(a,b){g[a]=d[a]}),c.push(g)}),new La(c)}}},La.prototype.ignoreColumns=function(a){var b=this.data;if(Ca(b)){if(!Ha(b))throw TypeError("The data should be an array of dictionaries.");if(0!==b.length&&Ca(a)&&Ha(a)){var c=[],e=[];return b.forEach(function(d,f){0==f&&(e=Object.keys(b[0]).filter(function(b){return-1==a.indexOf(b)}));var g={};e.forEach(function(a,b){g[a]=d[a]}),c.push(g)}),new La(c)}}},La.prototype.filterColumns=function(a){var b=this.data;if(Ca(b)){if(!Ha(b))throw TypeError("The data should be an array of dictionaries.");if(0!==b.length){var c=[],e=[];return b.forEach(function(d,f){0==f&&(e=Object.keys(b[0]).filter(a));var g={};e.forEach(function(a,b){g[a]=d[a]}),c.push(g)}),new La(c)}}},Ma.prototype.remove=function(){var a=this;void 0!==a&&void 0!==a.group&&(a.group.remove(),a.group=void 0)},Ma.prototype.append=function(a){var b=this;void 0!==b.group&&b.group.append(a)},Na.prototype=Object.create(Ma.prototype),Na.prototype.constructor=Na,Na.prototype.remove=function(){Ma.prototype.remove.call(this),this.lines=void 0,this.areas=void 0,this.markers=void 0},Oa.prototype=Object.create(Ma.prototype),Oa.prototype.constructor=Oa,Oa.prototype.remove=function(){Ma.prototype.remove.call(this),this.x=void 0,this.y=void 0,this.y2=void 0},Pa.prototype=Object.create(Ma.prototype),Pa.prototype.constructor=Pa,Pa.prototype.remove=function(){Oa.prototype.remove.call(this.labels),Ma.prototype.remove.call(this),this.x=void 0,this.y=void 0,this.y2=void 0,this.labels=void 0},Qa.prototype=Object.create(Ma.prototype),Qa.prototype.constructor=Qa,Ra.prototype=Object.create(Ma.prototype),Ra.prototype.constructor=Ra,Ra.prototype.remove=function(){Ma.prototype.remove.call(this),this.rect=void 0},Sa.prototype=Object.create(Ma.prototype),Sa.prototype.constructor=Sa,Sa.prototype.remove=function(){Ma.prototype.remove.call(this),this.hline=void 0,this.vline=void 0,this.dots=void 0,this.box=void 0,this.text=void 0},Ta.prototype.removeAll=function(){this.axes.remove(),this.box.remove(),this.lines.remove(),this.legend.remove(),this.interactive.remove();for(var a=this.main.node();a.hasChildNodes();)a.removeChild(a.lastChild)},Ua.prototype.copy=function(a){if(!a instanceof Ua)throw TypeError("You can only copy a d3lines.Chart object");this.options=Ka(a.options),this.width=a.width,this.height=a.height,this.margins=Ka(a.margins),this.xaxis=a.xaxis,this.yaxis=a.yaxis,this.y2axis=a.y2axis,this.line_options=Ka(a.line_options);var b=this.scale;Object.keys(a.scale).forEach(function(c){b[c]=a.scale[c]}),this.svg=a.svg},Ua.prototype.redrawXAxis=function(a){var b=this;Ca(b.svg.axes.x)&&Ca(b.xaxis)&&b.svg.axes.x.call(b.xaxis),Ca(a)||(a=!0),a&&(eb(b.svg.main,b.options),fb(b.svg.main,b.options,b.scale.hasOwnProperty("y2")))},Ua.prototype.redrawYAxis=function(a){var b=this;Ca(b.svg.axes.y)&&Ca(b.yaxis)&&b.svg.axes.y.call(b.yaxis),Ca(a)||(a=!0),a&&(eb(b.svg.main,b.options),fb(b.svg.main,b.options,b.scale.hasOwnProperty("y2")))},Ua.prototype.redrawY2Axis=function(a){var b=this;Ca(b.svg.axes.y2)&&Ca(b.y2axis)&&b.svg.axes.y2.call(b.y2axis),Ca(a)||(a=!0),a&&(eb(b.svg.main,b.options),fb(b.svg.main,b.options,b.scale.hasOwnProperty("y2")))},Ua.prototype.redrawLine=function(a){function g(a,b){return(!d.hasOwnProperty("x")||!isNaN(d.x[b]))&&((!d.hasOwnProperty("y")||!isNaN(d.offset_y[b]))&&(!d.hasOwnProperty("y2")||!isNaN(d.offset_y2[b])))}var b=this;if(Ca(b.svg.lines.lines)){var c=b.svg.lines.lines[a],d=b.line_options[a],e=b.svg.lines.areas[a],f=b.svg.lines.markers[a];if(d.hasOwnProperty("x")&&(d.hasOwnProperty("y")||d.hasOwnProperty("y2"))){data=Array(d.x.length);var h=Va(b.scale.x,b.scale.y,b.scale.y2,d);if(h.defined(g),c.attr("d",h(data)),Ca(e)){var i=d3.svg.area().x(h.x()).y(h.y()).y0(b.scale.y.range()[0]).defined(g).interpolate(d.interpolation);e.attr("d",i)}Ca(f)&&f.selectAll("path").attr("transform",function(a,b){return"translate("+h.x()(a,b)+","+h.y()(a,b)+")"})}}},Ua.prototype.redrawLines=function(){var a=this;if(Ca(a.svg.lines.lines)&&Ca(a.svg.lines.areas)&&Ca(a.svg.lines.markers)&&!(Ha(a.svg.lines.lines)&&Ha(a.svg.lines.areas)&&Ha(a.svg.lines.markers)&&a.line_options.length!==a.svg.lines.lines.length&&a.svg.lines.areas.length!==a.svg.lines.lines.length&&a.svg.lines.markers.length!==a.svg.lines.lines.length)){a.svg.lines.lines.forEach(function(b,c){a.redrawLine(c)})}},Ua.prototype.redraw=function(){var a=this;a.scale.hasOwnProperty("original_x")&&a.scale.hasOwnProperty("original_y")&&a.scale.hasOwnProperty("x")&&a.scale.hasOwnProperty("y")&&Ca(a.svg.lines.lines)&&Ca(a.svg.lines.areas)&&Ca(a.svg.lines.markers)&&(a.redrawXAxis(!1),a.redrawYAxis(!1),a.redrawY2Axis(!1),eb(a.svg.main,a.options),fb(a.svg.main,a.options,a.scale.hasOwnProperty("y2")),a.redrawLines())},Ua.prototype.reset=function(){var a=this;a.scale.hasOwnProperty("original_x")&&a.scale.hasOwnProperty("x")&&a.scale.x.domain([a.scale.original_x.domain()[0],a.scale.original_x.domain()[1]]),a.scale.hasOwnProperty("original_y")&&a.scale.hasOwnProperty("y")&&a.scale.y.domain([a.scale.original_y.domain()[0],a.scale.original_y.domain()[1]]),a.scale.hasOwnProperty("original_y2")&&a.scale.hasOwnProperty("y2")&&a.scale.y2.domain([a.scale.original_y2.domain()[0],a.scale.original_y2.domain()[1]]),a.redraw()},{isArray:Ha,isNumeric:Da,hline:Xa,vline:Wa,Data:La,Chart:Ua,SVGChart:Ta,SVGGroup:Ma,SVGAxesGroup:Pa,SVGAxesLabelGroup:Oa,SVGBoxGroup:Ra,SVGInteractiveGroup:Sa,SVGLegendGroup:Qa,SVGLinesGroup:Na,plot:function(ha,Da,Ea){function Dc(a){if(Ca(a)){Cc=a;var b=a.pageX-Ga.offsetLeft,c=a.pageY-Ga.offsetTop,d=(b-lb.left)/(mb-lb.left-lb.right),e=1-(c-lb.top)/(nb-lb.top-lb.bottom);if(Ca(wc)&&wc.style("display","none"),Ca(xc)&&xc.style("display","none"),Ca(Ac)&&Ca(Bc)&&(Ac.style("display","none"),Bc.style("display","none")),Ca(zc)&&zc.forEach(function(a){a.style("display","none")}),!(d<0||d>1||e<0||e>1)){if("x"==lc.snap_axis){var f=ob.invert(b),g=cb(f,Ta,lc.snap_axis),h=g[0],i=g[1],j=g[2];Ca(wc)&&wc.attr("x1",ob(Ta[i].x[j])).attr("x2",ob(Ta[i].x[j])).style("display","block")}else if("y"==lc.snap_axis){var k=pb.invert(c),g=cb(k,Ta,"offset_y"),h=g[0],i=g[1],j=g[2];Ca(xc)&&xc.attr("y1",pb(Ta[i].offset_y[j])).attr("y2",pb(Ta[i].offset_y[j])).style("display","block")}else if("both"==lc.snap_axis){var g=db(b,c,Ta,ob,pb,qb),h=g[0],i=g[1],j=g[2],l=g[3];Ca(wc)&&wc.attr("x1",ob(Ta[i].x[j])).attr("x2",ob(Ta[i].x[j])).style("display","block"),Ca(xc)&&("y"===l?xc.attr("y1",pb(Ta[i].offset_y[j])).attr("y2",pb(Ta[i].offset_y[j])).style("display","block"):"y2"===l&&Ca(qb)&&xc.attr("y1",qb(Ta[i].offset_y2[j])).attr("y2",qb(Ta[i].offset_y2[j])).style("display","block"))}if(Ca(zc))for(index=Ta.length-1;index>=0;index--){var m=Ta[index];h.hasOwnProperty(m.xkey)&&isNaN(h[m.xkey])?zc[index].style("display","none"):m.hasOwnProperty("ykey")&&h.hasOwnProperty(m.ykey)&&isNaN(h[m.ykey])?zc[index].style("display","none"):m.hasOwnProperty("y2key")&&h.hasOwnProperty(m.y2key)&&isNaN(h[m.y2key])?zc[index].style("display","none"):h.hasOwnProperty(m.ykey)||h.hasOwnProperty(m.y2key)?"stack"===Ba&&m.hasOwnProperty("ykey")&&isNaN(m.offset_y[j])?zc[index].style("display","none"):"stack"===Ba&&m.hasOwnProperty("y2key")&&isNaN(m.offset_y2[j])?zc[index].style("display","none"):("stack"===Ba?(zc[index].attr("cx",ob(h[m.xkey])),m.hasOwnProperty("ykey")?zc[index].attr("cy",pb(m.offset_y[j])):zc[index].attr("cy",qb(m.offset_y2[j]))):(zc[index].attr("cx",ob(h[m.xkey])),m.hasOwnProperty("ykey")?zc[index].attr("cy",pb(h[m.ykey])):zc[index].attr("cy",qb(h[m.y2key]))),zc[index].style("display","block")):zc[index].style("display","none")}var n=lc.output_string(h);if(Ca(Ac)&&Ca(Bc)){Bc.text("");var o=parseFloat(getComputedStyle(Bc[0][0]).fontSize);n.split(new RegExp("<br ?/?>")).forEach(function(a,d){Bc.append("tspan").text(a).attr("x",b+10+lc.box_padding).attr("y",c+10+lc.box_padding+o).attr("dy",1.2*d+"em")}),Bc.style("display","block");var p=Bc[0][0].getBBox(),q=p.height+2*lc.box_padding,r=p.width+2*lc.box_padding;if(nb-q<c+10){Ac.attr("y",nb-q);var s=Bc.selectAll("tspan");s.each(function(a,b){d3.select(s[0][b]).attr("y",nb-q+lc.box_padding+o)})}else Ac.attr("y",c+10);if(mb-r<b+10){Ac.attr("x",mb-r);var s=Bc.selectAll("tspan");s.each(function(a,b){d3.select(s[0][b]).attr("x",mb-r+lc.box_padding)})}else Ac.attr("x",b+10);Ac.attr("width",r).attr("height",q).style("display","block")}}}}if(!(ha instanceof d3.selection))throw TypeError("`svg` must be a d3.selection object.");var Ga=ha.node(),Ja=!1;Ca(Ea)&&"object"==typeof Ea&&(Ja=!0);var Ma=new Ua(ha);Ja?Ma.copy(Ea):Ma.options=Ka(Da);var Na=0;if(Ja&&Ha(Ma.line_options)&&(Na=Ma.line_options.length),Ca(Da)&&"object"!=typeof Da)throw TypeError("`options` should be an Object");var Oa=Ka(Da)||{};Ba=Ia(Oa,"plot_type",c);var Pa=Ia(Oa,"data");if(Ca(Pa)){Pa instanceof La||(Pa=new La(Pa));Ia(Oa,"data_sanitization",b)&&(Pa=Pa.sanitize()),Pa=Pa.data}var Ra=Ia(Oa,"xkey"),Sa=Ia(Oa,"ykey");"scatter"==Ba?(qa=Ia(Oa,"line_width",j),va=Ia(Oa,"marker",p),wa=Ia(Oa,"marker_fill",r),xa=Ia(Oa,"marker_fill_opacity",t)):(qa=Ia(Oa,"line_width",i),va=Ia(Oa,"marker",o),wa=Ia(Oa,"marker_fill",q),xa=Ia(Oa,"marker_fill_opacity",s)),Aa=Ia(Oa,"line_yaxis",g),pa=Ia(Oa,"line_color",h),ra=Ia(Oa,"line_style",k),sa=Ia(Oa,"line_fill",l),ta=Ia(Oa,"line_fill_opacity",m),ua=Ia(Oa,"line_interpolation",n),ya=Ia(Oa,"marker_stroke_width",u),za=Ia(Oa,"marker_size",v);var Ta=[],gb=[],hb=[],ib=[],jb=[];if(Ca(Ra)&&(gb.push(Ra),jb.push(Ra)),Ca(Sa)&&(hb.push(Sa),jb.push(Sa)),Ca(Oa.lines)&&(Oa.lines.forEach(function(a){!a.hasOwnProperty("xkey")&&Ca(Ra)&&(a.xkey=Ra),a.hasOwnProperty("ykey")||a.hasOwnProperty("y2key")||!Ca(Sa)||(a.ykey=Sa);var b=bb(a,Na);Na+=1,b.hasOwnProperty("xkey")&&-1==jb.indexOf(b.xkey)&&(gb.push(b.xkey),jb.push(b.xkey)),b.hasOwnProperty("ykey")&&-1==jb.indexOf(b.ykey)?(hb.push(b.ykey),jb.push(b.ykey)):-1==jb.indexOf(b.y2key)&&(ib.push(b.y2key),jb.push(b.y2key)),Ta.push(b)}),delete Oa.lines),0==Ta.length&&Ca(Pa)){if(!Ha(Pa))throw TypeError("Wrong type for `data`");Object.keys(Pa[0]).forEach(function(a){var b=ab(Aa,Na);Ca(Ra)?a!=Ra&&("right"===b?Ta.push(bb({xkey:Ra,y2key:a},Na)):Ta.push(bb({xkey:Ra,ykey:a},Na)),Na+=1):("right"===b?Ta.push(bb({y2key:a},Na)):Ta.push(bb({ykey:a},Na)),Na+=1)})}if(Ta.length>0&&!Ca(Pa))throw TypeError("`data` is undefined.");if(Ta.length>0&&!Ha(Pa))throw TypeError("Wrong type for `data`");if(Ta.length>0&&0==Pa.length)throw new ValueError("`data` is empty");if(Ta.length>0&&Pa.forEach(function(a,b){jb.forEach(function(c){if(!a.hasOwnProperty(c))throw"Missing key "+c+" in data element "+b})}),Ta.forEach(function(a,b){if(a.hasOwnProperty("xkey")&&!a.hasOwnProperty("x")?a.x=Array.apply(null,Array(Pa.length)).map(function(b,c){return Pa[c][a.xkey]}):(a.xkey="index",a.x=Array.apply(null,Array(Pa.length)).map(function(a,b){return b})),a.hasOwnProperty("ykey")&&!a.hasOwnProperty("y")?(a.y=Array.apply(null,Array(Pa.length)).map(function(b,c){return Pa[c][a.ykey]}),"stack"===Ba&&b!=Ta.length-1||(a.offset_y=Array.apply(null,Array(Pa.length)).map(function(b,c){return Pa[c][a.ykey]}),a.offset_y2=Array.apply(null,Array(Pa.length)).map(function(a,b){return 0}))):a.hasOwnProperty("y2key")&&!a.hasOwnProperty("y2")&&(a.y2=Array.apply(null,Array(Pa.length)).map(function(b,c){return Pa[c][a.y2key]}),"stack"===Ba&&b!=Ta.length-1||(a.offset_y2=Array.apply(null,Array(Pa.length)).map(function(b,c){return Pa[c][a.y2key]}),a.offset_y=Array.apply(null,Array(Pa.length)).map(function(a,b){return 0}))),!a.hasOwnProperty("x"))throw"ValueError: LINES["+b+"] does not have the `x` key";if(!a.hasOwnProperty("xkey"))throw"ValueError: LINES["+b+"] does not have the `xkey` key";if(!a.hasOwnProperty("y")&&!a.hasOwnProperty("y2"))throw"ValueError: LINES["+b+"] does not have the `y` oy `y2` key";if(!a.hasOwnProperty("ykey")&&!a.hasOwnProperty("y2key"))throw"ValueError: LINES["+b+"] does not have the `ykey` oy `y2key` key"}),"stack"===Ba)for(line_index=Ta.length-2;line_index>=0;line_index--){var kb=Ta[line_index];kb.hasOwnProperty("y")?(kb.offset_y=Array.apply(null,Array(kb.y.length)).map(function(a,b){var c=Ta[line_index+1].offset_y[b];return kb.y[b]+c}),kb.offset_y2=Array.apply(null,Array(Pa.length)).map(function(a,b){return 0})):kb.hasOwnProperty("y2")&&(kb.offset_y2=Array.apply(null,Array(kb.y2.length)).map(function(a,b){var c=Ta[line_index+1].offset_y2[b];return kb.y2[b]+c}),kb.offset_y=Array.apply(null,Array(Pa.length)).map(function(a,b){return 0}))}var lb={};if(Ja){var mb=Ia(Ma,"WIDTH",d,!1),nb=Ia(Ma,"HEIGHT",e,!1);Object.keys(f).forEach(function(a,b){lb[a]=f[a]}),Ca(Ma.margins)&&Object.keys(Ma.margins).forEach(function(a,b){lb[a]=Ma.margins[a]}),Oa.hasOwnProperty("width")&&delete Oa.width,Oa.hasOwnProperty("height")&&delete Oa.height,Oa.hasOwnProperty("margins")&&delete Oa.margins}else{var mb=Ia(Oa,"width",d),nb=Ia(Oa,"height",e);Object.keys(f).forEach(function(a,b){lb[a]=f[a]}),Ca(Oa.margins)&&(Object.keys(Oa.margins).forEach(function(a,b){lb[a]=Oa.margins[a]}),delete Oa.margins),Ma.width=mb,Ma.height=nb,Ma.margins=lb}if(mb<lb.left+lb.right)throw"ValueError: `width` should be larger than the sum of the left and right margins.";if(Ja)Ma.scale.hasOwnProperty("x")||(Ma.scale.x=d3.scale.linear()),Ma.scale.hasOwnProperty("y")||(Ma.scale.y=d3.scale.linear()),ob=Ia(Ma.scale,"x",d3.scale.linear(),!1),pb=Ia(Ma.scale,"y",d3.scale.linear(),!1),qb=Ia(Ma.scale,"y2",void 0,!1),Ca(Oa.xscale_type)&&delete Oa.xscale_type,Ca(Oa.yscale_type)&&delete Oa.yscale_type,Ca(Oa.y2scale_type)&&delete Oa.y2scale_type;else{var ob,pb,qb;Ca(Oa.xscale_type)?("time"==Oa.xscale_type?(ob=d3.time.scale(),ob.type=a.TIME):"log"==Oa.xscale_type?(ob=d3.scale.log(),ob.type=a.LOG):(ob=d3.scale.linear(),ob.type=a.LINEAR),delete Oa.xscale_type):(ob=d3.scale.linear(),ob.type=a.LINEAR),Ca(Oa.yscale_type)?("time"==Oa.yscale_type?(pb=d3.time.scale(),pb.type=a.TIME):"log"==Oa.yscale_type?(pb=d3.scale.log(),pb.type=a.LOG):(pb=d3.scale.linear(),pb.type=a.LINEAR),delete Oa.yscale_type):(pb=d3.scale.linear(),pb.type=a.LINEAR),Ca(Oa.y2scale_type)&&("time"==Oa.y2scale_type?(qb=d3.time.scale(),qb.type=a.TIME):"log"==Oa.y2scale_type?(qb=d3.scale.log(),qb.type=a.LOG):(qb=d3.scale.linear(),qb.type=a.LINEAR),delete Oa.y2scale_type)}Ta.forEach(function(b){b.hasOwnProperty("y2key")&&!Ca(qb)&&(qb=d3.scale.linear(),qb.type=a.LINEAR)});var rb=Ia(Oa,"xticks",w),sb=Ia(Oa,"yticks",x),tb=Ia(Oa,"y2ticks",y),ub=Ia(Oa,"xtick_format",z),vb=Ia(Oa,"ytick_format",A),wb=Ia(Oa,"y2tick_format",B),xb=Ia(Oa,"box",C),Kb=(Ia(Oa,"xgrid",D),Ia(Oa,"xgrid_color",E),Ia(Oa,"xgrid_width",F),Ia(Oa,"xgrid_linestyle",G),Ia(Oa,"ygrid",H),Ia(Oa,"ygrid_color",I),Ia(Oa,"ygrid_width",J),Ia(Oa,"ygrid_linestyle",K),Ia(Oa,"y2grid",L),Ia(Oa,"y2grid_color",M),Ia(Oa,"y2grid_width",N),Ia(Oa,"y2grid_linestyle",O),Ia(Oa,"legend",P)),Lb=Ia(Oa,"legend_font_size",Q),Mb=Ia(Oa,"legend_font_color",R),Nb=Ia(Oa,"legend_font_family",S),Ob=Ia(Oa,"legend_fill",T),Pb=Ia(Oa,"legend_fill_opacity",U),Qb=Ia(Oa,"legend_border_color",V),Rb=Ia(Oa,"legend_border_width",W),Sb=Ia(Oa,"legend_border_style",X),Tb=Ia(Oa,"legend_position",Y),Ub=Ia(Oa,"legend_labels"),Vb=Ia(Oa,"xlim",Z),Wb=Ia(Oa,"ylim",$),Xb=Ia(Oa,"y2lim",_),Yb=Ia(Oa,"xlabel",aa);""===Yb&&Ca(Ra)&&(Yb=Ra);var Zb=Ia(Oa,"ylabel",ba),$b=Ia(Oa,"y2label",ca),_b=Ia(Oa,"xlabel_offset",da),ac=Ia(Oa,"ylabel_offset",ea),bc=Ia(Oa,"y2label_offset",fa),cc=Ia(Oa,"axes_font_size",ga),dc=Ia(Oa,"axes_font_color",ja),ec=Ia(Oa,"axes_font_family",ia),fc=Ia(Oa,"axes_color",ja),gc=Ia(Oa,"axes_width",ka),hc=Ia(Oa,"axes_fill",la),ic=Ia(Oa,"axes_fill_opacity",ma),jc=Ia(Oa,"axes_linestyle",na),kc=Ia(Oa,"interactive",oa),lc={};if(Object.keys(DEFAULT_INTERACTIVE_OPTIONS).forEach(function(a,b){lc[a]="snap_axis"===a&&"scatter"===Ba?"both":DEFAULT_INTERACTIVE_OPTIONS[a]}),Ca(Oa.interactive_options)&&(Object.keys(Oa.interactive_options).forEach(function(a,b){lc[a]=Oa.interactive_options[a]}),delete Oa.interactive_options),-1===["x","y","both"].indexOf(lc.snap_axis)&&(lc.snap_axis="x"),Object.keys(Oa).forEach(function(a){throw"ValueError: unknown key `"+a+"`"}),Ja?(Za(Pa,Ta,"x",Vb,ob,Ja),Za(Pa,Ta,"y",Wb,pb,Ja),Ma.scale.original_x=ob.copy(),Ma.scale.original_y=pb.copy(),Ca(qb)&&(qb.range([nb-lb.bottom,lb.top]),Za(Pa,Ta,"y2",Xb,qb,Ja),Ma.scale.y2=qb,Ma.scale.original_y2=qb.copy())):(Ga.setAttribute("style","width:"+mb+"px; height:"+nb+"px"),Ga.style.width=mb,Ga.style.height=nb,ob.range([lb.left,mb-lb.right]),Za(Pa,Ta,"x",Vb,ob),pb.range([nb-lb.bottom,lb.top]),Za(Pa,Ta,"y",Wb,pb),Ma.scale.x=ob,Ma.scale.original_x=ob.copy(),Ma.scale.y=pb,Ma.scale.original_y=pb.copy(),Ca(qb)&&(qb.range([nb-lb.bottom,lb.top]),Za(Pa,Ta,"y2",Xb,qb),Ma.scale.y2=qb,Ma.scale.original_y2=qb.copy())),Ja||(Ma.svg.clip_path=ha.append("clipPath").attr("id","clipPath").append("rect").attr("x",lb.left).attr("y",lb.top).attr("width",mb-lb.left-lb.right).attr("height",nb-lb.top-lb.bottom)),Ja)var mc=Ia(Ma,"XAXIS",d3.svg.axis().scale(ob),!1);else var mc=d3.svg.axis().scale(ob).outerTickSize(0);if(Ca(rb)&&mc.ticks(rb),Ca(ub)&&mc.tickFormat(ub),Ja)var nc=Ia(Ma,"YAXIS",d3.svg.axis().scale(pb).orient("left"),!1);else var nc=d3.svg.axis().scale(pb).orient("left").outerTickSize(0);if(Ca(sb)&&nc.ticks(sb),Ca(vb)&&nc.tickFormat(vb),Ca(qb)){if(Ja)var oc=Ia(Ma,"Y2AXIS",d3.svg.axis().scale(qb).orient("right"),!1);else var oc=d3.svg.axis().scale(qb).orient("right").outerTickSize(0);Ca(tb)&&oc.ticks(tb),Ca(wb)&&oc.tickFormat(wb)}var pc=Ca(Ma.svg.box.group);xb||Ma.svg.box.remove(),xb&&!pc&&(Ma.svg.box.group=ha.append("g").attr("class","d3lines-box"),Ma.svg.box.rect=Ma.svg.box.group.append("rect").attr("x",lb.left).attr("y",lb.top).attr("width",mb-lb.left-lb.right).attr("height",nb-lb.top-lb.bottom).style("stroke",fc).style("stroke-width",gc).style("stroke-dasharray",$a(jc)).style("fill",hc).style("fill-opacity",ic)),Ja&&Ca(Ma.svg.lines.lines)||(Ma.svg.lines.lines=[]),Ja&&Ca(Ma.svg.lines.areas)||(Ma.svg.lines.areas=[]),Ja&&Ca(Ma.svg.lines.markers)||(Ma.svg.lines.markers=[]),Ja&&Ca(Ma.line_options)||(Ma.line_options=[]),Ja&&Ca(Ma.svg.lines.group)||(Ma.svg.lines.group=ha.append("g").attr("class","d3lines-lines"));var qc,rc=0;if(Ja&&(rc=Ma.line_options.length),Ta.forEach(function(a,b){function c(b,c){return(!a.hasOwnProperty("x")||!isNaN(a.x[c]))&&((!a.hasOwnProperty("offset_y")||!isNaN(a.offset_y[c]))&&(!a.hasOwnProperty("offset_y2")||!isNaN(a.offset_y2[c])))}Ma.line_options.push(a);var d=Va(ob,pb,qb,a);d.defined(c);var e=a.color,f=a.width,g=a.style,h=a.fill,i=a.fill_opacity;if(qc=a.hasOwnProperty("label")?a.label:Ca(Ub)?ab(Ub,b+rc):a.hasOwnProperty("ykey")?a.ykey:a.hasOwnProperty("y2key")?a.y2key:"","color"===h&&(h=e),"none"!=h){var j=d3.svg.area().x(d.x()).y(d.y()).y0(pb.range()[0]).defined(c).interpolate(a.interpolation);Ma.svg.lines.areas.push(Ma.svg.lines.group.append("path").datum(Pa).attr("d",j).style("fill",h).style("fill-opacity",i).attr("clip-path","url(#clipPath)"))}else Ma.svg.lines.areas.push(null);if(Ma.svg.lines.lines.push(Ma.svg.lines.group.append("svg:path").attr("d",d(Pa)).attr("clip-path","url(#clipPath)").attr("data-legend",qc).attr("data-line-color",e).attr("data-line-width",f).attr("data-line-style",g).attr("data-line-fill",h).attr("data-marker",a.marker).attr("data-marker-fill",a.marker_fill).attr("data-marker-fill-opacity",a.marker_fill_opacity).attr("data-marker-stroke-width",a.marker_stroke_width).attr("data-marker-size",a.marker_size).attr("data-legend-pos",b+rc).style("fill","none").style("stroke",e).style("stroke-width",f).style("stroke-dasharray",$a(g))),""!=a.marker){var k=a.marker_fill;"color"==k&&(k=e),Ma.svg.lines.markers.push(Ma.svg.lines.group.append("g").attr("clip-path","url(#clipPath)").attr("class","d3lines-markers")),Ma.svg.lines.markers[Ma.svg.lines.markers.length-1].selectAll(".markersymbols").data(Pa).enter().append("path").attr("d",_a(a.marker,a.marker_size)).attr("transform",function(a,b){return"translate("+d.x()(a,b)+","+d.y()(a,b)+")"}).style("stroke",e).style("fill",k).style("fill-opacity",a.marker_fill_opacity).style("stroke-width",a.marker_stroke_width)}else Ma.svg.lines.markers.push(null)}),Ca(Zb)||1!==Ma.svg.lines.lines.length||(Zb=qc),Ca(Ma.svg.axes.group)||(Ma.svg.axes.group=ha.append("g").attr("class","d3lines-axes")),Ja||(Ma.xaxis=mc,Ma.svg.axes.x=Ma.svg.axes.group.append("svg:g").attr("class","d3lines-axis d3lines-xaxis").attr("transform","translate(0,"+(nb-lb.bottom)+")").call(mc),Ma.yaxis=nc,Ma.svg.axes.y=Ma.svg.axes.group.append("svg:g").attr("class","d3lines-axis d3lines-yaxis").attr("transform","translate("+lb.left+",0)").call(nc),Ca(qb)&&(Ma.y2axis=oc,Ma.svg.axes.y2=Ma.svg.axes.group.append("svg:g").attr("class","d3lines-axis d3lines-y2axis").attr("transform","translate("+(mb-lb.right)+",0)").call(oc)),eb(ha,Da),fb(ha,Da,Ca(qb)),Ma.svg.axes.labels.group=Ma.svg.axes.group.append("g").attr("class","d3lines-label"),Ca(Yb)&&(Ma.svg.axes.labels.x=Ma.svg.axes.labels.group.append("text").attr("text-anchor","middle").attr("x",mb/2).attr("y",nb+_b-5).text(Yb).style("font-size",cc),void 0!==dc&&Ma.svg.axes.labels.x.style("fill",dc),void 0!==ec&&Ma.svg.axes.labels.x.style("font-family",ec)),Ca(Zb)&&(Ma.svg.axes.labels.y=Ma.svg.axes.labels.group.append("text").attr("text-anchor","middle").attr("x",-nb/2).attr("y",-ac).attr("dy",".75em").attr("transform","rotate(-90)").text(Zb).style("font-size",cc),void 0!==dc&&Ma.svg.axes.labels.y.style("fill",dc),void 0!==ec&&Ma.svg.axes.labels.y.style("font-family",ec)),Ca($b)&&(Ma.svg.axes.labels.y2=Ma.svg.axes.labels.group.append("text").attr("text-anchor","middle").attr("x",nb/2).attr("y",-mb-bc).attr("dy",".75em").attr("transform","rotate(90)").text($b).style("font-size",cc),void 0!==dc&&Ma.svg.axes.labels.y2.style("fill",dc),void 0!==ec&&Ma.svg.axes.labels.y2.style("font-family",ec))),Ja&&(Ma.redraw(),Ta=Ma.line_options),Ma.svg.interactive.remove(),Ta.length>0&&kc){var sc=ob.domain()[0],uc=(ob.domain()[1],pb.domain()[0]);pb.domain()[1];if(Ma.svg.interactive.group=ha.append("g").attr("class","d3lines-interactive"),Ia(lc,"line",!1)){var wc=Wa(Ma.svg.interactive.group,sc,ob,pb);wc.attr("class","d3lines-interactive-vline").attr("clip-path","url(#clipPath)").style("stroke-dasharray",$a(lc.line_style)).style("stroke",lc.line_color).style("stroke-width",lc.line_width).style("display","none"),Ma.svg.interactive.vline=wc;var xc=Xa(Ma.svg.interactive.group,uc,ob,pb);xc.attr("class","d3lines-interactive-hline").attr("clip-path","url(#clipPath)").style("stroke-dasharray",$a(lc.line_style)).style("stroke",lc.line_color).style("stroke-width",lc.line_width).style("display","none"),Ma.svg.interactive.hline=xc}if(Ia(lc,"dots",!1)){Ja&&Ca(Ma.svg.interactive.dots)||(Ma.svg.interactive.dots=[]);var yc=Ma.svg.interactive.group.append("g").attr("clip-path","url(#clipPath)");Ta.forEach(function(a,b){Ma.svg.interactive.dots.push(yc.append("circle").attr("r",lc.dot_radius).style("fill",a.color).style("display","none"))});var zc=Ma.svg.interactive.dots}if(Ia(lc,"textbox",!1)){var Ac=Ma.svg.interactive.group.append("rect").attr("x",0).attr("y",0).attr("width",50).attr("height",50).style("fill",lc.box_fill).style("fill-opacity",lc.box_fill_opacity).style("display","none");Ma.svg.interactive.box=Ac;var Bc=Ma.svg.interactive.group.append("text").attr("x",0).attr("y",0).style("display","none").style("fill",lc.font_color).style("font-size",lc.font_size).style("font-family",lc.font_family);Ma.svg.interactive.text=Bc}var Cc;Ga.addEventListener("mousemove",Dc),lc.zoom&&ha.call(d3.behavior.zoom().x(ob).y(pb).on("zoom",function(){if(Ca(qb)){var a=pb.domain(),b=Ma.scale.original_y(a[0]),c=Ma.scale.original_y(a[1]),d=[];d.push(Ma.scale.original_y2.invert(b)),d.push(Ma.scale.original_y2.invert(c)),qb.domain(d)}Ma.redraw(),Dc(Cc)}))}if(Ma.svg.legend.remove(),Kb&&Ta.length>0){Ma.svg.legend.group=ha.append("g").attr("class","d3lines-legend").attr("data-style-padding",10).style("font-size",Lb).call(Ya),Ma.svg.legend.group.select("rect").style("fill",Ob).style("fill-opacity",Pb).style("stroke",Qb).style("stroke-width",Rb).style("stroke-dasharray",$a(Sb));var Ec=Ma.svg.legend.group.selectAll("rect")[0][0].getBBox(),Fc=0,Gc=0;if(Ha(Tb)&&2==Tb.length)Fc=Tb[0],Gc=Tb[1];else try{var Hc=JSON.parse(Tb);if(!Ha(Hc)){var Ic="Invalid legend position (valid values are 'top left', 'top right', ... or 2-element arrays with the position (ex: [100, 200]))";throw console.log(Ic),TypeError(Ic)}if(2!=Hc.length)throw Ic="Invalid legend position (valid values are 'top left', 'top right', ... or 2-element arrays with the position (ex: [100, 200]))",console.log(Ic),TypeError(Ic);Fc=Hc[0],Gc=Hc[1]}catch(a){Fc=-1==Tb.indexOf("right")?lb.left+10:mb-lb.right-Ec.width-10,Gc=-1==Tb.indexOf("bottom")?lb.top+10:nb-lb.bottom-Ec.height-10}Ma.svg.legend.group.attr("transform","translate("+Fc+","+Gc+")"),void 0!==Mb&&Ma.svg.legend.group.selectAll("text").style("fill",Mb),void 0!==Nb&&Ma.svg.legend.group.style("font-family",Nb)}return Ma},groupByPlot:function(a,b,c,d,e,f){function g(){return str="Usage:\n",str+="    plt = d3lines.groupByPlot(svg, data, groupByKey, renameKeys)\n\n",str+="Arguments:\n",str+="    svg (d3.selection): a d3 selection of the svg DOM element where you want your plot to be drawn\n",str+="    data (Array of objects or Array): the data to plot\n",str+="    xkey (string): the name of the key for the x-axis\n",str+="    groupByKey (string): the name of the key to group the data by\n\n",str+="Optional arguments:\n",str+="    renameKeys (function): a function to rename the data keys using the group name",str+="\n",str}if(!(a instanceof d3.selection))throw TypeError("`svg` must be a d3.selection object.");if(arguments.length<4)throw Error("Not enough arguments\n\n"+g());arguments.length<6&&(f=function(a,b){return a+" ("+b+")"});var h;if(Ca(e)&&"object"!=typeof e)throw TypeError("`options` should be an Object");var i=Ka(e)||{};i.hasOwnProperty("data")&&delete i.data,i.hasOwnProperty("xkey")&&delete i.xkey,b instanceof La&&(b=b.data);var j=d3.nest().key(function(a){return a[d]}).entries(b),k=Ia(i,"legend",P),l=Ia(i,"interactive",oa),m=Ia(i,"legend_labels");return k&&!Ca(m)&&(legend_labels=[]),j.forEach(function(e,g){b=e.values,b=new d3lines.Data(b).ignoreColumns([d]).data,b.forEach(function(a,b){Object.keys(a).forEach(function(d){d!==c&&(a[f(d,e.key)]=a[d],0==b&&k&&!Ca(m)&&legend_labels.push(f(d,e.key)),delete a[d])})}),add_options={data:b,legend:!1,interactive:!1,xkey:c},Ca(m)&&(add_options.legend_labels=m),Object.keys(i).forEach(function(a){add_options[a]=i[a]}),0==g?h=d3lines.plot(a,add_options):(g===j.length-1&&(k?(Ca(m)?add_options.legend_labels=m:add_options.legend_labels=legend_labels,add_options.legend=!0):add_options.legend=!1,add_options.interactive=l),h=d3lines.plot(a,add_options,h))}),h}}}();